<div class="header">
  <h3>Submitted Requests</h3>
  <div class="switch">
  
  <% if current_user %>
      <div>Signed in as <strong><%= current_user.name %></strong>!</div>
      <%= button_to 'Sign Out', '/logout', id: 'signout',:method => "get"%>
  <% else %>
      <%= button_to 'Sign in with Facebook', 'auth/facebook', id: 'sign_in',:method => "get" %>
  <% end %>
  <%= button_to 'View Locations', 'locations' , :method => "get"%>
  <%= button_to 'New Requests', 'requests/new',:method => "get" %>
  </div>
</div>

<div class="container"> 
    <div class="caption">View All Requests</div>
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Pick-Up Location</th>
                <th>Drop-Off Location</th>
                <th>Date for Request</th>
                <th>Arrival Time</th>
                <th>Departure Time</th>
                <th>Status</th>
            </tr>
        </thead>
        <% @requests = Request.where(user_id: current_user) %>
        <% @requests.each do |request| %>
        <tbody>
            <tr>
                <td><%= current_user.name %></td>
                <td><%= request.PULocation %></td>
                <td><%= request.DOLocation %></td>
                <td><%= request.PUDate %></td>
                <td><%= request.ArrivalTime %></td>
                <td><%= request.DepartureTime %></td>
                <td><%= request.status %></td>
            
                <td class="tableButton"><%= link_to 'Show', request_path(request.id), :method => :GET , :id => "Show"%></td>
                
                <% if current_user.user_type == "Student" %>
                    <td class="tableButton"><%= link_to 'Delete', request_path(request.id), :method => :DELETE  %></td>
                <% end %>
                <!--<%= link_to 'Update', request_path(request.id), :method => :POST %></td>-->
            
                <% if current_user.user_type == "Manager" %>
                    <% if request.status == "Pending"%>
                        <td><%= link_to 'Accept', request_path(request.id, :status => "Accepted"), :method => :POST, class: "tableButton" %></td>
                        <td><%= link_to 'Deny', request_path(request.id, :status => "Denied"), :method => :POST, class: "tableButton" %></td>
                    <% elsif request.status == "Accepted"%>
                        <td><%= link_to 'Deny', request_path(request.id, :status => "Denied"), :method => :POST, class: "tableButton" %></td>
                    <% elsif request.status == "Denied"%>
                        <td><%= link_to 'Accept', request_path(request.id, :status => "Accepted"), :method => :POST, class: "tableButton" %></td>
                    <% end %> 
                <% end %>
            </tr>
        </tbody>
        <% end %>
    </table>
</div> 
